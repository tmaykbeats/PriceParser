## üß≠ –≠—Ç–∞–ø 0. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1.  –£ –≤–∞—Å –µ—Å—Ç—å:
    *   –§–æ—Ä–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è **PriceParser** (–¥–∞–ª–µ–µ PP) ‚Äì –¥–æ–ø—É—Å—Ç–∏–º, –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –≤ –ø–∞–ø–∫–µ `PriceParser/`.
    *   –ê—Ä—Ö–∏–≤ —Å **product-inflation-tracker** (–¥–∞–ª–µ–µ PIT) ‚Äì —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `product-inflation-tracker/`.

2.  **–ò–∑—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É PIT**, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è. –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã PIT:
    *   `tracker.py` ‚Äì –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.
    *   `configs/` ‚Äì –ø–∞–ø–∫–∞ —Å JSON-—à–∞–±–ª–æ–Ω–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞. –í –Ω–∏—Ö –æ–ø–∏—Å–∞–Ω–æ, –∫–∞–∫ –∏–∑–≤–ª–µ–∫–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω—É, —Ä–∞–∑–º–µ—Ä —É–ø–∞–∫–æ–≤–∫–∏.
    *   `parser_utils.py` ‚Äì —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ Selenium, –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º).
    *   `price_parser.py` ‚Äì –ª–æ–≥–∏–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ü–µ–Ω—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∏ –ø–µ—Ä–µ—Å—á—ë—Ç–∞ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞.
    *   `database.py` ‚Äì —Ä–∞–±–æ—Ç–∞ —Å SQLite (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤).
    *   `config_loader.py` ‚Äì –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤.

3.  **–ò–∑—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É PP**, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –∫—É–¥–∞ –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥:
    *   `app/` ‚Äì –æ—Å–Ω–æ–≤–Ω–∞—è –ø–∞–ø–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
        *   `database.py` ‚Äì –º–æ–¥–µ–ª–∏ SQLAlchemy (—Ç–∞–±–ª–∏—Ü—ã `User`, `Product`, `PriceHistory`, `Subscription` –∏ —Ç.–¥.).
        *   `scheduler.py` ‚Äì –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (APScheduler), –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä—Å–µ—Ä—ã.
        *   `parsers/` ‚Äì –ø–∞–ø–∫–∞ —Å –ø–∞—Ä—Å–µ—Ä–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ozon.py`, `wb.py`).
        *   `bot/` ‚Äì –∫–æ–¥ Telegram-–±–æ—Ç–∞ (aiogram): —Ö–µ–Ω–¥–ª–µ—Ä—ã, –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
        *   `web/` ‚Äì FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Ä–æ—É—Ç—ã, —à–∞–±–ª–æ–Ω—ã).
        *   `config.py` ‚Äì –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

---

## üì¶ –≠—Ç–∞–ø 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PP)

–ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ PP –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–º–µ—Ä–µ —É–ø–∞–∫–æ–≤–∫–∏ –∏ —Ü–µ–Ω–µ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É. –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±–æ—Ç–µ –∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã.

**–§–∞–π–ª:** `app/database.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
1.  –í –º–æ–¥–µ–ª—å `Product` –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è:
    *   `unit_size` (Float, nullable=True) ‚Äì —Ä–∞–∑–º–µ—Ä —É–ø–∞–∫–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1.0 –¥–ª—è –ª–∏—Ç—Ä–∞, 0.9 –¥–ª—è 900 –º–ª).
    *   `unit_type` (String, nullable=True) ‚Äì —Ç–∏–ø –µ–¥–∏–Ω–∏—Ü—ã: '–ª', '–∫–≥', '—à—Ç', '–≥' –∏ —Ç.–ø.
    *   `price_per_unit` (Float, nullable=True) ‚Äì —Ü–µ–Ω–∞ –∑–∞ 1 –ª–∏—Ç—Ä/–∫–≥ (–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ).
    *   `external_id` (String, unique, nullable=True) ‚Äì –µ—Å–ª–∏ —Ö–æ—Ç–∏–º —Ö—Ä–∞–Ω–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–∑ PIT (–º–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è).
2.  –í –º–æ–¥–µ–ª—å `PriceHistory` (–µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) —Ç–æ–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `unit_size`, `unit_type`, `price_per_unit`, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏. –õ–∏–±–æ –≤—ã—á–∏—Å–ª—è—Ç—å `price_per_unit` –Ω–∞ –ª–µ—Ç—É –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞.

**–ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π (SQLAlchemy):**
```python
class Product(Base):
    __tablename__ = 'products'
    
    id = Column(Integer, primary_key=True)
    name = Column(String, nullable=False)
    store = Column(String, nullable=False)
    current_price = Column(Float, nullable=False)
    # –ù–æ–≤—ã–µ –ø–æ–ª—è
    unit_size = Column(Float, nullable=True)
    unit_type = Column(String(10), nullable=True)
    price_per_unit = Column(Float, nullable=True)
    external_id = Column(String, unique=True, nullable=True)
    
    # —Å–≤—è–∑–∏...
```

**–ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Alembic) –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –ë–î –∏ –ø–æ–∑–≤–æ–ª–∏—Ç—å SQLAlchemy —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).

---

## üîå –≠—Ç–∞–ø 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–æ–≤ PIT –≤ PP

### 2.1. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π PIT

–°–æ–∑–¥–∞–π—Ç–µ –≤ PP –Ω–æ–≤—É—é –ø–∞–ø–∫—É: `app/parsers/pit_integration/`. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—é–¥–∞ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –∏–∑ PIT (–∏–ª–∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, –∞–¥–∞–ø—Ç–∏—Ä—É—è –ø–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—É PP):

*   `config_loader.py` ‚Äì –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤ –º–∞–≥–∞–∑–∏–Ω–æ–≤.
*   `parser_utils.py` ‚Äì —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è Selenium.
*   `price_parser.py` ‚Äì —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ü–µ–Ω—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.
*   `tracker.py` ‚Äì –Ω–æ –Ω–µ —Ü–µ–ª–∏–∫–æ–º, –∞ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `parse_product`, `process_store`). –°–∞–º `tracker.py` —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –∑–∞–ø—É—Å–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, –Ω–æ —É –Ω–∞—Å —ç—Ç–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ PP.

–¢–∞–∫–∂–µ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É `configs/` –∏–∑ PIT –≤ `app/parsers/pit_integration/configs/`. –ó–¥–µ—Å—å –±—É–¥—É—Ç –ª–µ–∂–∞—Ç—å JSON-—à–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ (–ü—è—Ç—ë—Ä–æ—á–∫–∞, –î–∏–∫—Å–∏ –∏ —Ç.–¥.).

### 2.2. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ–¥–∞ –ø–æ–¥ –æ–∫—Ä—É–∂–µ–Ω–∏–µ PP

–í —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—É—Ç–∏ –∫ –∫–æ–Ω—Ñ–∏–≥–∞–º) –Ω–∞ –ø—É—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞ PP. –¢–∞–∫–∂–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (Selenium, webdriver-manager –∏ —Ç.–ø.) ‚Äì –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ `requirements.txt` PP.

### 2.3. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—ë—Ä—Ç–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

–í –ø–∞–ø–∫–µ `app/parsers/` —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä `product_inflation_parser.py`. –í –Ω—ë–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç:
*   –ó–∞–≥—Ä—É–∂–∞—Ç—å —Å–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –±—Ä–∞—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ –∏–∑ –ë–î PP ‚Äì –ø–æ–∑–∂–µ –º—ã —Å–¥–µ–ª–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞).
*   –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä—Å–µ—Ä –∏–∑ PIT.
*   –°–æ–±–∏—Ä–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π –∏–ª–∏ –æ–±—ä–µ–∫—Ç–æ–≤.

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
```python
# app/parsers/product_inflation_parser.py
import sys
from pathlib import Path
# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –º–æ–¥—É–ª—è–º PIT
sys.path.append(str(Path(__file__).parent / 'pit_integration'))

from config_loader import load_store_configs, load_products
from tracker import process_store  # –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –µ—Å—Ç—å

async def run_pit_parser():
    """
    –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏ —Ç–æ–≤–∞—Ä–æ–≤.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏:
    [
        {
            'store': '–ü—è—Ç—ë—Ä–æ—á–∫–∞',
            'product_name': '–ú–æ–ª–æ–∫–æ 3.2%',
            'price': 89.99,
            'unit_size': 1.0,
            'unit_type': '–ª',
            'price_per_unit': 89.99,
            'external_id': '...'
        },
        ...
    ]
    """
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ pit_integration/configs
    stores = load_store_configs('app/parsers/pit_integration/configs')
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ –∏–∑ –ë–î)
    products = load_products('products.csv')  # –∏–ª–∏ –æ—Ç–∫—É–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ
    
    results = []
    for store_name, store_config in stores.items():
        for product in products:
            data = process_store(store_config, product)
            if data:
                results.append(data)
    return results
```

**–í–∞–∂–Ω–æ:** —Ñ—É–Ω–∫—Ü–∏—è `process_store` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Ç–∞–∫, —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö —Å—Ä–∞–∑—É –≤ –ë–î PIT. –ú—ã –±—É–¥–µ–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª–∏ PP.

---

## üîÅ –≠—Ç–∞–ø 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î PP

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –º—ã –ø–æ–ª—É—á–∏–ª–∏ —Å–ø–∏—Å–æ–∫ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü—ã `Product` –∏ `PriceHistory`.

### 3.1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ Product

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
*   –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–æ–≤–∞—Ä —Å —Ç–∞–∫–∏–º `store` –∏ `name` (–∏–ª–∏ `external_id`).
*   –ï—Å–ª–∏ –Ω–µ—Ç ‚Äì —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å `Product`, –∑–∞–ø–æ–ª–Ω—è—è –≤—Å–µ –ø–æ–ª—è.
*   –ï—Å–ª–∏ –¥–∞ ‚Äì –æ–±–Ω–æ–≤–ª—è–µ–º `current_price`, `price_per_unit` –∏ —Ç.–¥.

### 3.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ PriceHistory

–°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω, –ø—Ä–∏–≤—è–∑—ã–≤–∞—è –µ—ë –∫ `product_id`. –°—é–¥–∞ —Ç–æ–∂–µ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å `unit_size`, `unit_type`, `price_per_unit` –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLAlchemy):**
```python
from app.database import async_session, Product, PriceHistory

async def save_parsed_data(results):
    async with async_session() as session:
        for item in results:
            # –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞
            product = await session.execute(
                select(Product).where(
                    Product.store == item['store'],
                    Product.name == item['product_name']
                )
            )
            product = product.scalar_one_or_none()
            
            if not product:
                product = Product(
                    name=item['product_name'],
                    store=item['store'],
                    current_price=item['price'],
                    unit_size=item['unit_size'],
                    unit_type=item['unit_type'],
                    price_per_unit=item['price_per_unit'],
                    external_id=item.get('external_id')
                )
                session.add(product)
                await session.flush()  # —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å product.id
            else:
                # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É
                product.current_price = item['price']
                product.price_per_unit = item['price_per_unit']
            
            # –°–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏
            history = PriceHistory(
                product_id=product.id,
                price=item['price'],
                unit_size=item['unit_size'],
                unit_type=item['unit_type'],
                price_per_unit=item['price_per_unit'],
                timestamp=datetime.utcnow()
            )
            session.add(history)
        
        await session.commit()
```

---

## ‚è∞ –≠—Ç–∞–ø 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º PP

–í PP —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `scheduler.py`). –ù–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äì –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–µ–≥–æ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å `run_pit_parser()` –∏ –∑–∞—Ç–µ–º `save_parsed_data()`.

**–§–∞–π–ª:** `app/scheduler.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
1.  –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏.
2.  –í —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00.

**–ü—Ä–∏–º–µ—Ä:**
```python
from apscheduler.triggers.cron import CronTrigger
from .parsers.product_inflation_parser import run_pit_parser, save_parsed_data

async def scheduled_pit_parse():
    results = await run_pit_parser()
    await save_parsed_data(results)

def setup_scheduler(scheduler):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
    scheduler.add_job(
        scheduled_pit_parse,
        trigger=CronTrigger(hour=2, minute=0),  # –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
        id='pit_parser',
        replace_existing=True
    )
```

**–ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–∞—Ä—Å–µ—Ä—ã**, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –º–µ—à–∞–ª–∏ –∏ –Ω–µ —Ç—Ä–∞—Ç–∏–ª–∏ —Ä–µ—Å—É—Ä—Å—ã. –î–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ –≤—ã–∑–æ–≤—ãÂéüÊúâÁöÑ –∑–∞–¥–∞—á –≤ `scheduler.py`.

---

## üõí –≠—Ç–∞–ø 5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ ¬´–ö–æ—Ä–∑–∏–Ω–∞¬ª

–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É —Ç–æ–≤–∞—Ä–æ–≤ –∏ –≤–∏–¥–µ—Ç—å –µ—ë –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å.

### 5.1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã

–í `app/database.py` –¥–æ–±–∞–≤–∏–º –º–æ–¥–µ–ª–∏:

```python
class Basket(Base):
    __tablename__ = 'baskets'
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey('users.id'), nullable=False)
    name = Column(String, default='–ú–æ—è –∫–æ—Ä–∑–∏–Ω–∞')
    created_at = Column(DateTime, default=datetime.utcnow)
    
    user = relationship('User', back_populates='baskets')
    items = relationship('BasketItem', back_populates='basket', cascade='all, delete-orphan')

class BasketItem(Base):
    __tablename__ = 'basket_items'
    id = Column(Integer, primary_key=True)
    basket_id = Column(Integer, ForeignKey('baskets.id'), nullable=False)
    product_id = Column(Integer, ForeignKey('products.id'), nullable=False)
    quantity = Column(Float, default=1.0)  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫
    
    basket = relationship('Basket', back_populates='items')
    product = relationship('Product')
```

### 5.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ Telegram-–±–æ—Ç–∞

–í –ø–∞–ø–∫–µ `app/bot/handlers/` —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `basket.py` (–∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π). –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:

*   `/mybaskets` ‚Äì —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∑–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
*   `/create_basket <–Ω–∞–∑–≤–∞–Ω–∏–µ>` ‚Äì —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É.
*   `/delete_basket <id>` ‚Äì —É–¥–∞–ª–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É.
*   `/basket <id>` ‚Äì –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã: —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏, –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å, –≤–æ–∑–º–æ–∂–Ω–æ, –≥—Ä–∞—Ñ–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏.
*   `/add_to_basket <basket_id> <product_id> [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]` ‚Äì –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.
*   `/remove_from_basket <item_id>` ‚Äì —É–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è `/basket`:**
```python
@router.message(Command('basket'))
async def show_basket(message: Message, command: CommandObject):
    basket_id = int(command.args)
    async with async_session() as session:
        basket = await session.get(Basket, basket_id)
        if not basket or basket.user_id != message.from_user.id:
            await message.answer('–ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞')
            return
        
        items = await session.execute(
            select(BasketItem).where(BasketItem.basket_id == basket_id)
        )
        items = items.scalars().all()
        
        total = 0.0
        lines = [f'*{basket.name}*']
        for item in items:
            product = item.product
            price = product.current_price
            subtotal = price * item.quantity
            total += subtotal
            unit_info = f" ({product.unit_size}{product.unit_type})" if product.unit_size else ""
            lines.append(f"‚Ä¢ {product.name}{unit_info} ‚Äî {price} ‚ÇΩ √ó {item.quantity} = {subtotal:.2f} ‚ÇΩ")
        
        lines.append(f'*–ò—Ç–æ–≥–æ: {total:.2f} ‚ÇΩ*')
        await message.answer('\n'.join(lines))
```

### 5.3. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –∫–æ—Ä–∑–∏–Ω–∞ –±—ã–ª–∞ –≤–∏–¥–Ω–∞ –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–æ—É—Ç—ã –≤ FastAPI –∏ —à–∞–±–ª–æ–Ω—ã. –ù–∞–ø—Ä–∏–º–µ—Ä:

*   `/baskets` ‚Äì —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∑–∏–Ω —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω—É–∂–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è).
*   `/basket/{id}` ‚Äì –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—Ä–∑–∏–Ω—ã —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏.

–î–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É `matplotlib` –∏–ª–∏ `plotly`, –∫–∞–∫ —ç—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ PP –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤. –ù—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–±—Ä–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ü–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ –∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–∞–º, —Å—É–º–º–∏—Ä—É—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å —É—á—ë—Ç–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.

---

## üß™ –≠—Ç–∞–ø 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –¥–æ–±–∞–≤—å—Ç–µ –≤ `requirements.txt` PP –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PIT: `selenium`, `webdriver-manager`, `beautifulsoup4` (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞), `cloudscraper` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ). –¢–∞–∫–∂–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Firefox –∏ geckodriver (–∏–ª–∏ Chrome, –µ—Å–ª–∏ –±—É–¥–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ).

2.  **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏**:
    *   –í `app/parsers/pit_integration/configs/` —Å–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ JSON-—à–∞–±–ª–æ–Ω—ã –¥–ª—è –Ω—É–∂–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ (–ü—è—Ç—ë—Ä–æ—á–∫–∞, –î–∏–∫—Å–∏). –ú–æ–∂–Ω–æ –≤–∑—è—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏–∑ PIT –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–∞–π—Ç–æ–≤.
    *   –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è. –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `products.csv` –∏–ª–∏, —á—Ç–æ –ª—É—á—à–µ, —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É/–±–æ—Ç–∞ ‚Äì –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/add_product` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –±–∞–∑—É (–Ω–æ —Ç–æ–≥–¥–∞ –ø—Ä–∏–¥—ë—Ç—Å—è –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–∞—Ä—Å–µ—Ä–∞, —á—Ç–æ–±—ã –æ–Ω –∑–Ω–∞–ª, –∫–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –ø–∞—Ä—Å–∏—Ç—å). –ü–æ–∫–∞ –º–æ–∂–Ω–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Ç–µ—Å—Ç–∞.

3.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–µ—Ä –≤—Ä—É—á–Ω—É—é** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
    *   –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –≤—ã–∑–æ–≤ `scheduled_pit_parse()` –≤ –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –∏–ª–∏ –≤ –∫–æ–Ω—Å–æ–ª—å Django-like –∫–æ–º–∞–Ω–¥–æ–π (–µ—Å–ª–∏ –≤ PP –µ—Å—Ç—å manage.py). –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

4.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–æ—Ç–∞**:
    *   –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ –∫–æ—Ä–∑–∏–Ω—É, –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã (–ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/search` ‚Äì –µ—ë –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Ç–æ–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç).
    *   –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ª–∏ —Ü–µ–Ω–∞ –∑–∞ –ª–∏—Ç—Ä –∏ –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å.

5.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**:
    *   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É) –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–¥–∞—á–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.

6.  **–û—Ç–ª–∞–¥–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
    *   –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Å—Ç–∞—Ö, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –æ—à–∏–±–∫–∏.

---

## üöß –í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≤–µ—Ç—ã

*   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ PIT**: –í–æ–∑–º–æ–∂–Ω–æ, –≤–∞–º –ø—Ä–∏–¥—ë—Ç—Å—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –∫–æ–¥ PIT, —á—Ç–æ–±—ã –æ–Ω —Ä–∞–±–æ—Ç–∞–ª –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –∞ –Ω–µ –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç. –£–¥–µ–ª–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞–º –∏ –ø—É—Ç—è–º.
*   **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: PIT, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ (Selenium ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π). –í PP –∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (FastAPI, aiogram). –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ –ª—É—á—à–µ –≤—ã–Ω–æ—Å–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.to_thread`), —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å event loop. –í —Ñ—É–Ω–∫—Ü–∏–∏ `scheduled_pit_parse` –º–æ–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤—ã–∑–æ–≤ `run_pit_parser` –≤ `asyncio.to_thread`.
*   **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤**: –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∞–¥—ë–∂–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ –ø–∞—Ä—Å–µ—Ä–∞. –õ—É—á—à–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `external_id`, –µ—Å–ª–∏ PIT –µ–≥–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç. –ò–Ω–∞—á–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é `store:name:unit_size` (—É—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –º–µ–Ω—è—Ç—å—Å—è). –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏–¥—ë—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `sku` –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª, –µ—Å–ª–∏ –º–∞–≥–∞–∑–∏–Ω –µ–≥–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç.
*   **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–æ–≤–∞—è —Ü–µ–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `PriceHistory` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å (—á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –±–∞–∑—É). –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–æ–π.
*   **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ï—Å–ª–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –º–Ω–æ–≥–æ, –ø–∞—Ä—Å–∏–Ω–≥ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–¥—É–º–∞–π—Ç–µ –æ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.gather` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤ –≤ –ø–æ—Ç–æ–∫–∞—Ö).